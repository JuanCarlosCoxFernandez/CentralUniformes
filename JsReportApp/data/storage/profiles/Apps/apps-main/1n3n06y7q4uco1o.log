{"type":"operationStart","subtype":"profile","data":{"_id":"N8KZBatcXCEXKpEp","timestamp":"2024-01-17T20:01:58.000Z","state":"queued","mode":"standard","creationDate":"2024-01-17T20:01:58.003Z","modificationDate":"2024-01-17T20:01:58.003Z","shortid":"qnD_tM_","$entitySet":"profiles"},"doDiffs":false,"timestamp":1705521718002,"id":"qru3jmyuof18q7i","previousOperationId":null,"operationId":"qz1tu21sgmtfls7"}
{"type":"log","level":"info","message":"Render request 38 queued for execution and waiting for available worker","previousOperationId":"qz1tu21sgmtfls7","timestamp":1705521718002,"id":"bp9z4ohoiapivn0"}
{"type":"operationStart","subtype":"render","name":"apps-main","previousOperationId":"qz1tu21sgmtfls7","timestamp":1705521718014,"id":"tbmc0v129c89waq","previousEventId":"qru3jmyuof18q7i","operationId":"glh2yuw2yg3yun6"}
{"type":"log","timestamp":1705521718014,"level":"info","message":"Starting rendering request 38","meta":{"rootId":"1n3n06y7q4uco1o","id":"1n3n06y7q4uco1o"},"id":"o90txqs2tadssgj","previousOperationId":"glh2yuw2yg3yun6"}
{"type":"log","timestamp":1705521718014,"level":"info","message":"Rendering template { name: apps-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"1n3n06y7q4uco1o","id":"1n3n06y7q4uco1o"},"id":"63ex3453sahryvo","previousOperationId":"glh2yuw2yg3yun6"}
{"type":"log","timestamp":1705521718015,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"1n3n06y7q4uco1o","id":"1n3n06y7q4uco1o"},"id":"33ervcn167ukfzf","previousOperationId":"glh2yuw2yg3yun6"}
{"type":"log","timestamp":1705521718016,"level":"debug","message":"Executing script apps-script (beforeRender)","meta":{"rootId":"1n3n06y7q4uco1o","id":"1n3n06y7q4uco1o"},"id":"o0n02v1x8h7fy2v","previousOperationId":"glh2yuw2yg3yun6"}
{"type":"log","timestamp":1705521718028,"level":"warn","message":"Error when processing render request 38\n(because) error when evaluating custom script /Apps/apps-script\nmodule is not defined\n\n(sandbox.js line 42:1)\n\n  40 | }\n  41 |\n> 42 | module.exports = {\n     | ^\n  43 |     beforeRender\n  44 | };\n\n\nReferenceError: module is not defined\n    at sandbox.js:42:1","meta":{"rootId":"1n3n06y7q4uco1o","id":"1n3n06y7q4uco1o"},"id":"l7z69bs4v5grwv8","previousOperationId":"glh2yuw2yg3yun6"}
{"type":"log","timestamp":1705521718028,"level":"warn","message":"Rendering request 38 finished with error in 28 ms","meta":{"rootId":"1n3n06y7q4uco1o","id":"1n3n06y7q4uco1o"},"id":"ouzkuyq93w7l3ua","previousOperationId":"glh2yuw2yg3yun6"}
{"type":"error","timestamp":1705521718032,"statusCode":400,"weak":true,"lineNumber":42,"decoratedSuffix":"\n\n(sandbox.js line 42:1)\n\n  40 | }\n  41 |\n> 42 | module.exports = {\n     | ^\n  43 |     beforeRender\n  44 | };\n\n","entity":{"shortid":"fPhkMfgI1u","name":"apps-script","content":"const fs = require('fs').promises;\nconst path = require('path');\n\nconst rutaArchivoDatos = 'C:\\\\Users\\\\juank\\\\Proyectos\\\\Tecnologias\\\\JsReportApp\\\\data\\\\Apps\\\\apps-data\\\\dataJson.json';\n\nasync function beforeRender(req, res) {\n    try {\n        req.data.appsData = await prepareDataSource();\n    } catch (error) {\n        console.error('Error al obtener datos:', error);\n    }\n}\n\nasync function fetchApps() {\n    try {\n        const contenidoArchivo = await fs.readFile(rutaArchivoDatos, 'utf-8');\n        return JSON.parse(contenidoArchivo);\n    } catch (error) {\n        console.error('Error al analizar el archivo JSON:', error);\n        throw error;\n    }\n}\n\nasync function prepareDataSource() {\n    const apps = await fetchApps();\n    const httpAppsCount = apps.data.filter(app => app.URL.startsWith('http')).length;\n    const nonHttpAppsCount = apps.data.length - httpAppsCount;\n\n    const data = {\n        labels: ['HTTP', 'No HTTP'],\n        datasets: [{\n            data: [httpAppsCount, nonHttpAppsCount],\n            backgroundColor: ['rgba(27,161,226,0.2)', 'rgba(255,0,0,0.2)'],\n            borderColor: ['rgba(27,161,226,1)', 'rgba(255,0,0,1)'],\n            borderWidth: 1,\n        }]\n    };\n\n    return { apps, chartData: data }; // Ahora devuelve ambos datos de aplicaciones y datos de grÃ¡ficos\n}\n\nmodule.exports = {\n    beforeRender\n};"},"property":"content","logged":true,"previousOperationId":"glh2yuw2yg3yun6","id":"zz5gzsvhc1sb1il","stack":"ReferenceError: module is not defined\n    at sandbox.js:42:1","message":"Error when evaluating custom script /Apps/apps-script\nmodule is not defined\n\n(sandbox.js line 42:1)\n\n  40 | }\n  41 |\n> 42 | module.exports = {\n     | ^\n  43 |     beforeRender\n  44 | };\n\n"}
